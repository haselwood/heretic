<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Forest Society Policy Quiz</title>
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      color: #e4f4ec;
      background: #050910;
    }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #1a3b3b 0, #050910 55%);
      padding: 24px;
    }
    .app {
      background: rgba(7, 15, 20, 0.9);
      border-radius: 18px;
      border: 1px solid rgba(163, 232, 211, 0.25);
      box-shadow: 0 18px 60px rgba(0, 0, 0, 0.8);
      padding: 24px 28px;
      max-width: 900px;
      width: 100%;
      display: grid;
      grid-template-columns: minmax(0, 2.2fr) minmax(220px, 1.2fr);
      gap: 20px;
    }
    h1 {
      margin: 0 0 4px;
      font-size: 1.4rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #b5ffe4;
    }
    .subtitle {
      font-size: 0.9rem;
      color: #94b3a5;
      margin-bottom: 16px;
    }
    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }
    .q-number {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #6ee7b7;
    }
    .q-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: #e0fff2;
      margin-top: 4px;
    }
    .progress {
      font-size: 0.8rem;
      color: #7e968b;
    }
    .choices {
      display: grid;
      gap: 8px;
      margin-top: 10px;
      margin-bottom: 16px;
    }
    .choice {
      position: relative;
    }
    .choice input {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }
    .choice-label {
      display: block;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #1f343b;
      background: rgba(3, 9, 13, 0.9);
      font-size: 0.9rem;
      cursor: pointer;
      transition: border 0.15s ease, background 0.15s ease, transform 0.08s ease,
        box-shadow 0.1s ease;
    }
    .choice-label:hover {
      border-color: #38e0c3;
      background: #041017;
      box-shadow: 0 4px 16px rgba(56, 224, 195, 0.25);
      transform: translateY(-1px);
    }
    .choice input:checked + .choice-label {
      border-color: #4ade80;
      background: radial-gradient(circle at top left, #06301e 0, #020812 70%);
      box-shadow: 0 0 0 1px rgba(74, 222, 128, 0.35);
    }
    .nav {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.08s ease, box-shadow 0.1s ease, background 0.15s ease;
    }
    .btn-primary {
      background: linear-gradient(135deg, #22c1a1, #14b8a6);
      color: #021311;
      font-weight: 600;
      box-shadow: 0 10px 30px rgba(20, 184, 166, 0.55);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 40px rgba(20, 184, 166, 0.75);
    }
    .btn-secondary {
      background: rgba(15, 23, 42, 0.9);
      color: #c7e8db;
      border: 1px solid #223840;
    }
    .btn-secondary:hover {
      background: rgba(15, 23, 42, 1);
      transform: translateY(-1px);
    }
    .btn-ghost {
      background: transparent;
      color: #7e968b;
      border: none;
      padding-left: 0;
    }
    .btn-ghost:hover {
      color: #cbd5f5;
    }
    .sidebar {
      border-radius: 14px;
      background: radial-gradient(circle at top, #041d16 0, #02060b 70%);
      border: 1px solid rgba(45, 212, 191, 0.25);
      padding: 12px 14px 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .scores-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #6ee7b7;
    }
    .scores-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px 10px;
      font-size: 0.85rem;
    }
    .score-item {
      background: rgba(3, 10, 13, 0.85);
      border-radius: 8px;
      padding: 6px 7px;
      border: 1px solid rgba(15, 118, 110, 0.5);
    }
    .score-label {
      color: #a4cdbf;
      font-size: 0.78rem;
      margin-bottom: 2px;
    }
    .score-value {
      font-weight: 600;
      color: #e0fff2;
    }
    .result {
      margin-top: 4px;
      border-top: 1px dashed rgba(148, 163, 184, 0.35);
      padding-top: 6px;
      font-size: 0.8rem;
    }
    .ending-name {
      font-size: 0.98rem;
      font-weight: 600;
      color: #e0fff2;
    }
    .ending-tagline {
      color: #a4cdbf;
      margin-top: 2px;
    }
    .debug {
      font-family: ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.75rem;
      color: #8fb5a5;
      white-space: pre-wrap;
      margin-top: 4px;
    }
    @media (max-width: 800px) {
      .app {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div>
      <h1>Forest Policy Quiz</h1>
      <div class="subtitle">
        Answer each policy question. Your choices update the 6 alignment axes, and at the end
        you‚Äôll see which ending you‚Äôd get.
      </div>

      <div id="question-block">
        <div class="question-header">
          <div>
            <div class="q-number" id="q-number"></div>
            <div class="q-name" id="q-name"></div>
          </div>
          <div class="progress" id="q-progress"></div>
        </div>
        <div class="choices" id="choices-container"></div>
      </div>

      <div class="nav">
        <button class="btn-secondary" type="button" id="prev-btn">‚Üê Previous</button>
        <button class="btn-secondary" type="button" id="next-btn">Next ‚Üí</button>
        <button class="btn-primary" type="button" id="ending-btn">üîÆ Compute Ending</button>
        <button class="btn-ghost" type="button" id="reset-btn">Reset quiz</button>
      </div>
    </div>

    <div class="sidebar">
      <div class="scores-title">Alignment Scores</div>
      <div class="scores-grid">
        <div class="score-item">
          <div class="score-label">Faith (Rational ‚Üí Spiritual)</div>
          <div class="score-value" id="score-fa">0</div>
        </div>
        <div class="score-item">
          <div class="score-label">Control (Anarchy ‚Üí Authoritarian)</div>
          <div class="score-value" id="score-ct">0</div>
        </div>
        <div class="score-item">
          <div class="score-label">Economy (Capitalist ‚Üí Communal)</div>
          <div class="score-value" id="score-ec">0</div>
        </div>
        <div class="score-item">
          <div class="score-label">Openness (Protectionist ‚Üí Progressive)</div>
          <div class="score-value" id="score-op">0</div>
        </div>
        <div class="score-item">
          <div class="score-label">Progress (Traditional ‚Üí Innovation)</div>
          <div class="score-value" id="score-pr">0</div>
        </div>
        <div class="score-item">
          <div class="score-label">Tech (Green ‚Üí Industrial)</div>
          <div class="score-value" id="score-te">0</div>
        </div>
      </div>

      <div class="result" id="result-block">
        <div class="ending-name" id="ending-name">No ending computed yet</div>
        <div class="ending-tagline" id="ending-tagline">
          Answer all questions, then click ‚ÄúCompute Ending‚Äù.
        </div>
        <div class="debug" id="debug"></div>
      </div>
    </div>
  </div>

  <script>
    // === ACT 1 QUESTIONS (from your CSV) ===
    // Each choice has deltas for: FA, CT, EC, OP, PR, TE
    const QUESTIONS = [
      {
        id: 1,
        name: "How Shall We Honor the Dead?",
        choices: [
          {
            label: "Bury under saplings",
            deltas: { FA: 1, CT: 0, EC: 1, OP: 0, PR: 1, TE: -2 }
          },
          {
            label: "Burn & forge tools",
            deltas: { FA: -1, CT: 2, EC: 0, OP: 0, PR: 0, TE: 1 }
          },
          {
            label: "Let forest reclaim",
            deltas: { FA: 0, CT: -1, EC: 1, OP: 0, PR: 1, TE: -2 }
          },
          {
            label: "Mass grave",
            deltas: { FA: -1, CT: 1, EC: 0, OP: -1, PR: -1, TE: 0 }
          }
        ]
      },
      {
        id: 2,
        name: "Who is your New Council?",
        choices: [
          {
            label: "Elders",
            deltas: { FA: 1, CT: 1, EC: 0, OP: -1, PR: -1, TE: 0 }
          },
          {
            label: "Rotate species",
            deltas: { FA: 0, CT: 0, EC: 2, OP: 1, PR: 1, TE: 0 }
          },
          {
            label: "Consensus rule",
            deltas: { FA: -1, CT: -1, EC: 2, OP: 1, PR: 1, TE: 0 }
          },
          {
            label: "Just Player",
            deltas: { FA: 0, CT: 2, EC: 0, OP: -1, PR: -1, TE: 0 }
          }
        ]
      },
      {
        id: 3,
        name: "What do we do with this human machine we found?",
        choices: [
          {
            label: "Repurpose metal for tools",
            deltas: { FA: -1, CT: 0, EC: -1, OP: 1, PR: 1, TE: -1 }
          },
          {
            label: "Keep as a sacred relic",
            deltas: { FA: 2, CT: 1, EC: 0, OP: -1, PR: -1, TE: 0 }
          },
          {
            label: "Destroy it",
            deltas: { FA: 0, CT: 1, EC: 0, OP: -2, PR: -1, TE: -1 }
          },
          {
            label: "Community property",
            deltas: { FA: 0, CT: 0, EC: 1, OP: 1, PR: 1, TE: 0 }
          }
        ]
      },
      {
        id: 4,
        name: "How Are Disputes Settled?",
        choices: [
          {
            label: "Mediation circles",
            deltas: { FA: 1, CT: 0, EC: 2, OP: 1, PR: 1, TE: -1 }
          },
          {
            label: "Strict arbiter",
            deltas: { FA: -2, CT: 1, EC: 0, OP: 0, PR: -1, TE: 1 }
          },
          {
            label: "Trial by challenge",
            deltas: { FA: 0, CT: 1, EC: -1, OP: 0, PR: -1, TE: 0 }
          },
          {
            label: "Natural resolution",
            deltas: { FA: 0, CT: -2, EC: 0, OP: 0, PR: -1, TE: -2 }
          }
        ]
      },
      {
        id: 5,
        name: "Food Distribution",
        choices: [
          {
            label: "Equal rations distributed",
            deltas: { FA: 0, CT: 1, EC: 2, OP: 0, PR: 1, TE: 0 }
          },
          {
            label: "Free market",
            deltas: { FA: -1, CT: 1, EC: -2, OP: 0, PR: -1, TE: 1 }
          },
          {
            label: "Gather your own",
            deltas: { FA: 0, CT: -1, EC: 0, OP: 0, PR: 0, TE: -2 }
          },
          {
            label: "Communal meals served",
            deltas: { FA: 1, CT: 1, EC: 2, OP: 1, PR: 1, TE: 0 }
          }
        ]
      },
      {
        id: 6,
        name: "How do we rebuild our homes?",
        choices: [
          {
            label: "Communal longhouses",
            deltas: { FA: 1, CT: 0, EC: 2, OP: 1, PR: 0, TE: -1 }
          },
          {
            label: "Everyone stakes a claim and builds their own",
            deltas: { FA: -1, CT: -1, EC: -1, OP: 0, PR: 0, TE: 1 }
          },
          {
            label: "Assign dens by need",
            deltas: { FA: 0, CT: 1, EC: 2, OP: 1, PR: 1, TE: 1 }
          },
          {
            label: "Districts based on job and role",
            deltas: { FA: -1, CT: 1, EC: -1, OP: -1, PR: -1, TE: 2 }
          }
        ]
      },
      {
        id: 7,
        name: "How do we care for the sick?",
        choices: [
          {
            label: "Send away to a camp",
            deltas: { FA: -1, CT: 2, EC: 1, OP: -1, PR: -1, TE: -1 }
          },
          {
            label: "Must barter for care based on your resources",
            deltas: { FA: -1, CT: -1, EC: 2, OP: -1, PR: -1, TE: 1 }
          },
          {
            label: "Establish kingdom healer, available to all",
            deltas: { FA: 2, CT: 0, EC: 2, OP: 1, PR: 1, TE: -1 }
          },
          {
            label: "You're on your own",
            deltas: { FA: -1, CT: -2, EC: -1, OP: 0, PR: 0, TE: -1 }
          }
        ]
      },
      {
        id: 8,
        name: "Plan a festival ‚Äì how should the kingdom celebrate?",
        choices: [
          {
            label: "It‚Äôs orgy time",
            deltas: { FA: 1, CT: -1, EC: 2, OP: 0, PR: 1, TE: -1 }
          },
          {
            label: "Give thanks to the goddess",
            deltas: { FA: 2, CT: 0, EC: 1, OP: 0, PR: -1, TE: -1 }
          },
          {
            label: "Everyone gives gifts to loved ones",
            deltas: { FA: -1, CT: 0, EC: -2, OP: 0, PR: -1, TE: 1 }
          },
          {
            label: "Glorious leader day",
            deltas: { FA: 0, CT: 2, EC: 0, OP: -1, PR: -1, TE: 1 }
          }
        ]
      }
    ];

    // === Threshold helpers (Tech: negative = Green, positive = Industrial) ===
    const HIGH_POS = 5;
    const HIGH_NEG = -5;

    function isHighPos(v) { return v >= HIGH_POS; }
    function isHighNeg(v) { return v <= HIGH_NEG; }
    function isMid(v) { return v > HIGH_NEG && v < HIGH_POS; }

    const TE_HIGH_POS = 5;   // strongly Industrial (positive)
    const TE_HIGH_NEG = -5;  // strongly Green (negative)

    // === Ending resolver ===
    function resolveEnding(FA, CT, EC, OP, PR, TE) {
      const vals = { FA, CT, EC, OP, PR, TE };
      const highPosCount = Object.values(vals).filter(isHighPos).length;
      const highNegCount = Object.values(vals).filter(isHighNeg).length;

      const allMid =
        isMid(FA) && isMid(CT) && isMid(EC) &&
        isMid(OP) && isMid(PR) && isMid(TE);

      // 13. Forest Weavers (Balanced)
      if (allMid) {
        return {
          id: 13,
          name: "The Forest Weavers",
          tagline: "(Balanced Ending) The forest holds all its tensions in fragile harmony.",
          debug: "All stats are mid-range."
        };
      }

      // 11. Great Schism
      if (highPosCount >= 2 && highNegCount >= 2) {
        return {
          id: 11,
          name: "The Great Schism",
          tagline: "Opposing visions tear the forest into irreconcilable factions.",
          debug: `High positive axes: ${highPosCount}, high negative axes: ${highNegCount}.`
        };
      }

      // 12. Ascendant Revelation (cult + innovation)
      if (FA >= HIGH_POS && CT >= HIGH_POS && OP <= -4 && PR >= HIGH_POS) {
        return {
          id: 12,
          name: "The Ascendant Revelation",
          tagline: "A radiant doctrine seizes the forest, promising transcendence through obedience.",
          debug: "FA and CT very high, OP somewhat closed, PR very high."
        };
      }

      // 1. Verdant Theocracy
      if (FA >= HIGH_POS && CT > HIGH_NEG && OP < HIGH_POS && PR < HIGH_POS) {
        return {
          id: 1,
          name: "The Verdant Theocracy",
          tagline: "The forest is ruled by roots and rites; law is written in leaf and omen.",
          debug: "High Faith, not extreme anarchy, not hyper-open or hyper-innovative."
        };
      }

      // 2. Thorn Regime
      if (CT >= HIGH_POS && OP <= HIGH_NEG && PR <= 0) {
        return {
          id: 2,
          name: "The Thorn Regime",
          tagline: "Order at any cost. The forest tightens into a barbed crown.",
          debug: "High Control, very closed, traditional/non-innovative."
        };
      }

      // 3. Ironbloom Meritocracy (Capitalist + Industrial)
      if (EC <= HIGH_NEG && TE >= TE_HIGH_POS && FA <= 0 && CT > HIGH_NEG) {
        return {
          id: 3,
          name: "The Ironbloom Meritocracy",
          tagline: "Only the strongest shoots survive; steel and status feed the roots.",
          debug: "Economy strongly capitalist, Tech strongly industrial (positive TE)."
        };
      }

      // 4. Free-Root Collective
      if (EC >= HIGH_POS && CT <= HIGH_NEG && OP >= HIGH_POS) {
        return {
          id: 4,
          name: "The Free-Root Collective",
          tagline: "Borders blur, property dissolves, and the forest lives as one vast commune.",
          debug: "Communal economy, very free, very open."
        };
      }

      // 5. Cosmopolitan Grove
      if (OP >= HIGH_POS && isMid(CT)) {
        return {
          id: 5,
          name: "The Cosmopolitan Grove",
          tagline: "Paths and tongues cross freely; the forest becomes a crossroads of worlds.",
          debug: "Openness very high, Control moderate."
        };
      }

      // 6. Shielded Woodland
      if (OP <= HIGH_NEG && CT >= 0 && PR <= 0) {
        return {
          id: 6,
          name: "The Shielded Woodland",
          tagline: "Walls of bark and belief keep the outside at bay; safety is found in seclusion.",
          debug: "Closed borders, some order, traditional or neutral progress."
        };
      }

      // 7. Dawnbound Republic
      if (PR >= HIGH_POS && OP >= HIGH_POS && isMid(CT) && isMid(FA)) {
        return {
          id: 7,
          name: "The Dawnbound Republic",
          tagline: "Tradition roots the forest, but new ideas steer its sunlit council.",
          debug: "High Progress + Openness, mid Control + Faith."
        };
      }

      // 8. Emerald Symbiosis (Green Tech)
      if (TE <= TE_HIGH_NEG && PR >= 0 && OP >= 0 && EC >= 0) {
        return {
          id: 8,
          name: "The Emerald Symbiosis",
          tagline: "Vines and circuits entwine; the forest and its tools become one living system.",
          debug: "Tech strongly Green (negative TE) with neutral+ PR, OP, EC."
        };
      }

      // 9. Ashen Restoration
      if (PR >= HIGH_POS && FA <= 0 && isMid(TE) && EC >= 0) {
        return {
          id: 9,
          name: "The Ashen Restoration",
          tagline: "With clear eyes and scarred bark, the forest rebuilds from what was burned.",
          debug: "High Progress, low/neutral Faith, mid Tech, communal/neutral EC."
        };
      }

      // 10. Primeval Kingdom
      if (PR <= HIGH_NEG && CT >= HIGH_POS && FA >= 0) {
        return {
          id: 10,
          name: "The Primeval Kingdom",
          tagline: "Ancestral laws and crowned canopies rule; the oldest rings decide the newest growth.",
          debug: "Strongly Traditional, very high Control, Faith not hostile."
        };
      }

      // Fallback
      return {
        id: 0,
        name: "Unresolved Canopy",
        tagline: "The forest resists a single story; its future remains tangled and uncertain.",
        debug: "No specific ending profile matched. Tweak thresholds or add new endings."
      };
    }

    // === Quiz state ===
    let currentIndex = 0;
    const answers = new Array(QUESTIONS.length).fill(null);

    function recalcScores() {
      const totals = { FA: 0, CT: 0, EC: 0, OP: 0, PR: 0, TE: 0 };
      QUESTIONS.forEach((q, qi) => {
        const choiceIndex = answers[qi];
        if (choiceIndex == null) return;
        const deltas = q.choices[choiceIndex].deltas;
        for (const key in totals) {
          totals[key] += deltas[key] || 0;
        }
      });
      document.getElementById("score-fa").textContent = totals.FA;
      document.getElementById("score-ct").textContent = totals.CT;
      document.getElementById("score-ec").textContent = totals.EC;
      document.getElementById("score-op").textContent = totals.OP;
      document.getElementById("score-pr").textContent = totals.PR;
      document.getElementById("score-te").textContent = totals.TE;
      return totals;
    }

    function renderQuestion() {
      const q = QUESTIONS[currentIndex];
      document.getElementById("q-number").textContent = `Policy ${q.id}`;
      document.getElementById("q-name").textContent = q.name;
      document.getElementById("q-progress").textContent =
        `Question ${currentIndex + 1} of ${QUESTIONS.length}`;

      const container = document.getElementById("choices-container");
      container.innerHTML = "";
      q.choices.forEach((choice, idx) => {
        const choiceId = `q${currentIndex}-choice${idx}`;
        const wrapper = document.createElement("div");
        wrapper.className = "choice";

        const input = document.createElement("input");
        input.type = "radio";
        input.name = `q${currentIndex}`;
        input.id = choiceId;
        input.value = idx;
        if (answers[currentIndex] === idx) input.checked = true;

        input.addEventListener("change", () => {
          answers[currentIndex] = idx;
          recalcScores();
        });

        const label = document.createElement("label");
        label.className = "choice-label";
        label.setAttribute("for", choiceId);
        label.textContent = choice.label;

        wrapper.appendChild(input);
        wrapper.appendChild(label);
        container.appendChild(wrapper);
      });

      document.getElementById("prev-btn").disabled = currentIndex === 0;
      document.getElementById("next-btn").disabled =
        currentIndex === QUESTIONS.length - 1;
    }

    function computeEnding() {
      const totals = recalcScores();
      const res = resolveEnding(
        totals.FA,
        totals.CT,
        totals.EC,
        totals.OP,
        totals.PR,
        totals.TE
      );
      document.getElementById("ending-name").textContent = res.name;
      document.getElementById("ending-tagline").textContent = res.tagline;
      document.getElementById("debug").textContent =
        `FA: ${totals.FA}, CT: ${totals.CT}, EC: ${totals.EC}, OP: ${totals.OP}, PR: ${totals.PR}, TE: ${totals.TE}\n` +
        (res.debug || "");
    }

    function resetQuiz() {
      for (let i = 0; i < answers.length; i++) answers[i] = null;
      currentIndex = 0;
      recalcScores();
      document.getElementById("ending-name").textContent =
        "No ending computed yet";
      document.getElementById("ending-tagline").textContent =
        "Answer all questions, then click ‚ÄúCompute Ending‚Äù.";
      document.getElementById("debug").textContent = "";
      renderQuestion();
    }

    document.getElementById("prev-btn").addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        renderQuestion();
      }
    });
    document.getElementById("next-btn").addEventListener("click", () => {
      if (currentIndex < QUESTIONS.length - 1) {
        currentIndex++;
        renderQuestion();
      }
    });
    document.getElementById("ending-btn").addEventListener("click", computeEnding);
    document.getElementById("reset-btn").addEventListener("click", resetQuiz);

    renderQuestion();
    recalcScores();
  </script>
</body>
</html>
